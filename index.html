<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú—ñ–π –ë–æ—Ç-–°–ø—ñ–≤–∞–≤—Ç–æ—Ä</title>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 20px auto; }
        #chat-window {
            height: 300px;
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
            overflow-y: scroll; /* –î–æ–¥–∞—î –ø—Ä–æ–∫—Ä—É—Ç–∫—É */
        }
        .message { margin-bottom: 5px; }
        .user { text-align: right; color: blue; }
        .bot { color: green; }
    </style>
</head>
<body>

    <h1>ü§ñ –ë–æ—Ç-–°–ø—ñ–≤–∞–≤—Ç–æ—Ä "–û–ø—É—Å"</h1>

    <div id="chat-window">
        </div>

    <input type="text" id="userInput" placeholder="–ù–∞–ø–∏—à—ñ—Ç—å —â–æ—Å—å..." style="width: 70%;">
    <button id="sendButton">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏</button>

    <script>
        // –ó–Ω–∞—Ö–æ–¥–∏–º–æ –Ω–∞—à—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ
        const sendButton = document.getElementById('sendButton');
        const userInput = document.getElementById('userInput');
        const chatWindow = document.getElementById('chat-window');

        // –î–æ–¥–∞—î–º–æ "—Å–ª—É—Ö–∞—á–∞" –Ω–∞ –∫–Ω–æ–ø–∫—É "–ù–∞–¥—ñ—Å–ª–∞—Ç–∏"
        sendButton.addEventListener('click', sendMessage);

        // –î–æ–¥–∞—î–º–æ "—Å–ª—É—Ö–∞—á–∞" –Ω–∞ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è Enter —É –ø–æ–ª—ñ –≤–≤–æ–¥—É
        userInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // –ì–æ–ª–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
        async function sendMessage() {
            const messageText = userInput.value;
            if (messageText.trim() === '') return; // –ù–µ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—Ç–∏ –ø–æ—Ä–æ–∂–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è

            // 1. –ü–æ–∫–∞–∑—É—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —É —á–∞—Ç—ñ
            addMessageToChat(messageText, 'user');
            
            // –û—á–∏—â—É—î–º–æ –ø–æ–ª–µ –≤–≤–æ–¥—É
            userInput.value = '';

            // 2. –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –Ω–∞ –Ω–∞—à –±–µ–∫–µ–Ω–¥-—Å–µ—Ä–≤–µ—Ä
            const response = await fetch('/chat', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ message: messageText }), // –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –Ω–∞—à —Ç–µ–∫—Å—Ç —É —Ñ–æ—Ä–º–∞—Ç—ñ JSON
            });

            // 3. –û—Ç—Ä–∏–º—É—î–º–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –≤—ñ–¥ —Å–µ—Ä–≤–µ—Ä–∞
            const data = await response.json();
            const botMessage = data.message;

            // 4. –ü–æ–∫–∞–∑—É—î–º–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—å "–±–æ—Ç–∞" (–Ω–∞—à–µ –µ—Ö–æ) —É —á–∞—Ç—ñ
            addMessageToChat(botMessage, 'bot');
        }

        // –î–æ–ø–æ–º—ñ–∂–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è –º–∞–ª—é–≤–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å —É —á–∞—Ç—ñ
        function addMessageToChat(text, sender) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message', sender);
            messageElement.textContent = text;
            chatWindow.appendChild(messageElement);
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–æ–∫—Ä—É—á—É—î–º–æ –≤–Ω–∏–∑
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        // –ù–û–í–ï: –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
        async function loadHistory() {
            console.log('–ó–∞–≤–∞–Ω—Ç–∞–∂—É—é —ñ—Å—Ç–æ—Ä—ñ—é...');
            const response = await fetch('/get-history');
            const history = await response.json();

            if (history.length > 0) {
                // –ú–∞–ª—é—î–º–æ –∫–æ–∂–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ —ñ—Å—Ç–æ—Ä—ñ—ó
                history.forEach(message => {
                    const sender = message.role === 'model' ? 'bot' : 'user';
                    const text = message.parts[0].text;
                    addMessageToChat(text, sender);
                });
                console.log('–Ü—Å—Ç–æ—Ä—ñ—é —É—Å–ø—ñ—à–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ!');
            } else {
                // –Ø–∫—â–æ —ñ—Å—Ç–æ—Ä—ñ—ó –Ω–µ–º–∞—î (–ø–µ—Ä—à–∏–π –∑–∞–ø—É—Å–∫), –ø–æ–∫–∞–∑—É—î–º–æ –≤—ñ—Ç–∞–Ω–Ω—è –±–æ—Ç–∞
                addMessageToChat("–Ø –û–ø—É—Å, –≤–∞—à –ª—ñ—Ç–µ—Ä–∞—Ç—É—Ä–Ω–∏–π –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫. –ó —è–∫–æ—ó –≤–µ–ª–∏–∫–æ—ó —ñ–¥–µ—ó –º–∏ –ø–æ—á–Ω–µ–º–æ —Å—å–æ–≥–æ–¥–Ω—ñ? ‚úçÔ∏è", "bot");
            }
        }

        // –ù–û–í–ï: –ö–∞–∂–µ–º–æ –±—Ä–∞—É–∑–µ—Ä—É –≤–∏–∫–æ–Ω–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é loadHistory()
        // —â–æ–π–Ω–æ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –±—É–¥–µ –≥–æ—Ç–æ–≤–∞
        document.addEventListener('DOMContentLoaded', loadHistory);

    </script> 
</body>
</html>